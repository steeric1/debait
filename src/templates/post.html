<title>Debait - {{ post.title }}</title>
<h1>{{ post.title }}</h1>

<p>
    <strong>on</strong> {{ post.tag }}
    <br>
    <strong>posted by</strong> {{ post.author.name }} <strong>at</strong> {{ post.timestamp }}
</p>

<p>
    {{ post.content }}
</p>

{% if user %}
    <form id="comment-form">
        <h3>Leave comment</h3>
        <textarea cols="50" rows="6" name="content" id="content"></textarea>
        <br>
        <input type="submit" value="Send">
    </form>
{% else %}
    <a href="/login">Login</a> to leave a comment.
{% endif %}

<h3>Comments</h3>

{% for comment in comments|reverse %}
    <p>
        {{ comment.author.name }} <strong>said:</strong> {{ comment.content }}
        <br>
        <strong>at</strong> {{ comment.timestamp }}
    </p>
{% endfor %}

<script>
    let form = document.getElementById("comment-form");
    form.onsubmit = (event) => {
        event.preventDefault();

        let lastSlash = window.location.href.lastIndexOf("/");
        let url = `/comment${window.location.href.substring(lastSlash)}`;

        let payload = {
            "content": document.getElementById("content").value
        };

        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams(payload)
        });

        window.location.reload();
    }
</script>